# 🔌 Схема подключения

## 📋 Таблица подключений

| Компонент | Пин компонента | ESP32 GPIO | Примечание |
|-----------|----------------|------------|------------|
| **DS18B20** | | | |
| | VCC | 3.3V | Питание |
| | GND | GND | Земля |
| | DATA | GPIO 2 | Данные + резистор 4.7kΩ к VCC |
| **MAX7219** | | | |
| | VCC | 5V | Питание |
| | GND | GND | Земля |
| | DIN | GPIO 19 | Данные |
| | CLK | GPIO 18 | Синхронизация |
| | CS | GPIO 5 | Chip Select |
| **Зуммер** | | | |
| | + | GPIO 33 | Управление (через транзистор) |
| | - | GND | Земля |
| **Клапан (реле)** | | | |
| | Signal | GPIO 26 | Управление |
| | VCC | 5V | Питание реле |
| | GND | GND | Земля |
| **Кнопка сброса** | | | |
| | | GPIO 0 (BOOT) | Встроенная кнопка ESP32 |

---

## 🔧 Подробное описание

### 1️⃣ DS18B20 - Датчик температуры
```
DS18B20          ESP32
┌─────────┐
│  1 GND  ├──────── GND
│  2 DATA ├──────── GPIO 2 ──┐
│  3 VCC  ├──────── 3.3V     │
└─────────┘                  │
                             │
                     4.7kΩ   │
                     ┌───────┘
                     │
                   3.3V
```

**Важно:**
- Резистор 4.7kΩ обязателен (подтяжка линии DATA к VCC)
- Датчик может быть в корпусе TO-92 или водонепроницаемом
- Поддержка длинного кабеля (до 100м с правильной разводкой)

**Альтернативное питание:**
- Можно использовать 5V вместо 3.3V для большей стабильности
- При 5V резистор подтягивается к 5V

---

### 2️⃣ MAX7219 - LED дисплей 8 цифр
```
MAX7219 Module    ESP32
┌──────────────┐
│ VCC          ├─── 5V
│ GND          ├─── GND
│ DIN (MOSI)   ├─── GPIO 19
│ CLK (SCK)    ├─── GPIO 18
│ CS (LOAD)    ├─── GPIO 5
└──────────────┘
```

**Настройки:**
- Яркость: регулируется в коде `disp.brightness(0-15)`
- Количество модулей: 1 (можно расширить до 8 каскадом)

**Примечание:**
- Некоторые модули могут иметь маркировку DIN/DOUT/CLK/CS
- Проверьте распиновку на вашем модуле!

---

### 3️⃣ Зуммер (Buzzer) - D33

#### Вариант A: Активный зуммер (рекомендуется)
```
        ESP32 GPIO 33
             │
             ├─── Резистор 220Ω
             │
        ┌────┴────┐
        │   NPN   │  (2N2222, BC547)
    ┌───┤  транз. │
    │   │         │
    │   └─────────┘
    │        │
  ┌─┴─┐    GND
  │ + │
  │ 🔊│ Buzzer 5V
  │ - │
  └─┬─┘
    │
   5V
```

**Компоненты:**
- Транзистор NPN (2N2222, BC547, или аналог)
- Резистор 220Ω (база транзистора)
- Активный зуммер 5V

#### Вариант B: Пассивный зуммер

Можно подключить напрямую, но громкость будет ниже:
```
GPIO 33 ──┬── [Резистор 100Ω] ── (+) Buzzer
          │
         GND ─────────────────────── (-) Buzzer
```

---

### 4️⃣ Клапан через твердотельное реле - D26
```
        ESP32 GPIO 26
             │
             ├─── [Резистор 220Ω]
             │
    ┌────────┴────────┐
    │  Solid State    │
    │     Relay       │
    │   (5V trigger)  │
    └────────┬────────┘
             │
           220V AC
        (или нагрузка)
```

**Рекомендуемое реле:**
- SSR (Solid State Relay) 5V trigger
- Например: Fotek SSR-25 DA
- Нагрузка: до 25A (в зависимости от модели)

**Альтернатива - механическое реле:**
```
GPIO 26 ──┬─── [Диод 1N4007] ──┐
          │                     │
          └─── Резистор 220Ω ───┤
                                │
                           ┌────┴────┐
                           │  Relay  │
                           │  Coil   │
                           │  5V     │
                           └────┬────┘
                                │
                               GND
```

**Компоненты для механического реле:**
- Реле 5V (катушка)
- Диод 1N4007 (защита от обратного тока)
- Транзистор NPN (опционально)

---

### 5️⃣ Питание системы

#### Схема питания:
```
        [Блок питания 5V 2A]
                │
        ┌───────┴───────┐
        │               │
       5V              GND
        │               │
    ┌───┴───┐       ┌───┴───┐
    │ ESP32 │       │ MAX   │
    │  VIN  │       │ 7219  │
    └───────┘       └───────┘
        │
    ┌───┴───┐
    │ Реле  │
    │  5V   │
    └───────┘
```

**Требования:**
- Блок питания: 5V, минимум 2A
- ESP32 потребляет: ~500mA (в режиме WiFi)
- MAX7219 потребляет: ~300mA (при полной яркости)
- Реле: ~70-100mA
- Зуммер: ~30mA

**Итого:** ~1A (рекомендуется БП на 2A для запаса)

---

## ⚠️ Важные замечания

### Защита от помех:

1. **Конденсаторы развязки:**
   - 100nF керамический на VCC каждого модуля
   - 100-470µF электролитический на входе питания

2. **Длинные провода:**
   - Используйте экранированный кабель для DS18B20
   - Витая пара для сигнальных линий

3. **Заземление:**
   - Все GND должны быть соединены в одной точке
   - Избегайте "земляных петель"

### Безопасность:

- ⚠️ **220V AC** - опасное напряжение! Изолируйте контакты.
- ⚠️ Используйте SSR в корпусе с DIN-рейкой
- ⚠️ Не касайтесь контактов реле под напряжением
- ✅ Проверьте все соединения мультиметром **ДО** подачи питания

---

## 🖼️ Пример монтажа

### На макетной плате (для тестов):
```
┌─────────────────────────────────────┐
│  ┌───────────┐    ┌──────────────┐  │
│  │   ESP32   │    │   MAX7219    │  │
│  │  DevKit   │    │   Display    │  │
│  └─────┬─────┘    └──────┬───────┘  │
│        │                 │          │
│    ┌───┴─────────────────┴───┐      │
│    │    Breadboard            │      │
│    │  ┌─────┐  ┌─────┐       │      │
│    │  │ SSR │  │Buzz │       │      │
│    └──┴─────┴──┴─────┴───────┘      │
│                                      │
│  [Блок питания 5V 2A]               │
└─────────────────────────────────────┘
```

### В корпусе (финальный вариант):

- DIN-рейка для SSR
- Клеммники для подключения
- Вентиляция для ESP32
- Отдельный отсек для 220V

---

## 🔍 Проверка подключения

### Чеклист перед первым запуском:

- [ ] Все GND соединены вместе
- [ ] Резистор 4.7kΩ установлен на DS18B20
- [ ] MAX7219 подключен к 5V (не 3.3V)
- [ ] Диоды защиты установлены на катушках реле
- [ ] Полярность зуммера правильная
- [ ] Нет коротких замыканий (проверено мультиметром)
- [ ] Блок питания выдает стабильные 5V

### Тестирование по шагам:

1. **Питание:** Подключите только ESP32 → светодиод должен загореться
2. **Дисплей:** Запустите код → дисплей должен показать температуру
3. **Датчик:** Проверьте Serial Monitor → температура должна читаться
4. **Зуммер:** Команда `/zummer` → должен пищать
5. **Клапан:** Команда `/valve_on` → реле должно щелкнуть

---

## 📸 Фото примеров

*(Добавьте сюда фото вашей сборки)*

- Общий вид
- Подключение DS18B20
- Подключение дисплея
- Схема реле

---

## 🛠️ Альтернативные варианты

### Упрощенная версия (без дисплея):

Можно исключить MAX7219 и использовать только Telegram для мониторинга.

### Расширенная версия:

- Добавить второй датчик DS18B20
- Добавить LCD дисплей 20x4 I2C
- Добавить SD карту для логирования
- Добавить кнопки управления

---

Нужна помощь с подключением? Откройте [Issue на GitHub](https://github.com/your-username/samovar-esp32/issues)!
